---
layout: post
title: Implement basic AdMob in your app
date: 2023-01-12
permalink: /admob-basic/
categories: play-core, analytics
---

Mục lục
- [Flow](#flow)
- [Phân loại](#phân-loại)
- [Test AD\_ID](#test-ad_id)
- [Áp dụng](#áp-dụng)
  - [Banner](#banner)
  - [Interstitial](#interstitial)
  - [Rewarded](#rewarded)
  - [Native](#native)

# Flow
Ngoại trừ Banner ads thì các ads đều có 2 bước
- Load ads cache vào một biến
- Nếu là native ads thì cần bind ad đó với `NativeAdView` tương ứng
- Gọi `show()` khi cần hoặc với native ads là thêm nó vào chỗ mong muộn

# Phân loại
- Banner
- Interstitial: Immediate dismissable, fullscreen, có tuỳ chọn video
- App open
- Rewarded: Trao thưởng cho user sau khi sử dụng
- Rewarded Interstitial: Giống rewarded nhưng immediate dismissable
- Native: Tự code layout sau đó bind data ads lấy được xuống và nhúng vào app

# Test AD_ID
| App Open              | ca-app-pub-3940256099942544/3419835294 |
| --------------------- | -------------------------------------- |
| Banner                | ca-app-pub-3940256099942544/6300978111 |
| Interstitial          | ca-app-pub-3940256099942544/1033173712 |
| Interstitial Video    | ca-app-pub-3940256099942544/8691691433 |
| Rewarded              | ca-app-pub-3940256099942544/5224354917 |
| Rewarded Interstitial | ca-app-pub-3940256099942544/5354046379 |
| Native Advanced       | ca-app-pub-3940256099942544/2247696110 |
| Native Advanced Video | ca-app-pub-3940256099942544/1044960115 |

# Áp dụng
## Banner
```kt
@Composable
fun AdsBanner(modifier: Modifier = Modifier) {
    val isInEditMode = LocalInspectionMode.current
    if (isInEditMode) {
        Text(
            modifier = modifier
                .fillMaxWidth()
                .background(Color.Red)
                .padding(horizontal = 2.dp, vertical = 6.dp),
            textAlign = TextAlign.Center,
            color = Color.White,
            text = "Advert Here",
        )
    } else {
        AndroidView(modifier = modifier.fillMaxWidth(), factory = { context ->
            AdView(context).apply {
                setAdSize(AdSize.BANNER)
                adUnitId = context.getString(R.string.ad_id_banner)
                loadAd(AdRequest.Builder().build())
            }
        })
    }
}
```
## Interstitial
```kt
data class Wrapper(var interstitialAds: InterstitialAd?, var rewardedAds: RewardedAd?)

val wrapper = Wrapper(null, null)

@Composable
fun AdsInterstitial(wrapper: MainActivity.Wrapper) {
    val context = LocalContext.current
    Button(onClick = { showInterstitial(wrapper, context) }) {
        Text(text = "Show interstitial")
    }
}

fun showInterstitial(wrapper: MainActivity.Wrapper, context: Context) {
    if (wrapper.interstitialAds == null) {
        Log.d(TAG, "showInterstitial: Ads is null")
    } else {
        wrapper.interstitialAds!!.show(context as Activity)
    }
}
```
## Rewarded
```kt
@Composable
fun AdsRewarded(wrapper: MainActivity.Wrapper) {
    val context = LocalContext.current
    Button(onClick = { showRewarded(wrapper, context) }) {
        Text(text = "Show rewarded")
    }
}

fun showRewarded(wrapper: MainActivity.Wrapper, context: Context) {
    if (wrapper.rewardedAds == null) {
        Log.d(TAG, "showRewarded: Ads is null")
    } else {
        wrapper.rewardedAds!!.show(context as Activity) { it: RewardItem ->

        }
    }
}
```
## Native
Cách 1: Sử dụng [NativeTemplate](https://github.com/googleads/googleads-mobile-android-native-templates) có sẵn của GG:
```kt
class NativeEngine(context: Context, val templateView: TemplateView) {
    companion object {
        const val TAG = "NATIVE ENGINE"
    }

    private lateinit var adLoader: AdLoader

    init {
        setupAdLoader(context)
    }

    private fun setupAdLoader(context: Context) {
        adLoader = AdLoader.Builder(context, context.getString(R.string.ad_id_native))
            .forNativeAd {
                if ((context as Activity).isDestroyed) {
                    it.destroy()
                    return@forNativeAd
                }
                displayAd(templateView, it)
            }
            .withAdListener(object : AdListener() {
                override fun onAdFailedToLoad(p0: LoadAdError) {
                    super.onAdFailedToLoad(p0)
                    load()
                }
            })
            .withNativeAdOptions(
                NativeAdOptions.Builder()
                    .build()
            )
            .build()
    }

    private fun displayAd(parent: TemplateView, nativeAd: NativeAd) {
        val style = NativeTemplateStyle.Builder()
            .withMainBackgroundColor(ColorDrawable(Color.RED)).build()
        parent.setStyles(style)
        parent.setNativeAd(nativeAd)
    }

    fun load(quantity: Int = 1) {
        // TODO: Nah please just load one at a time
        adLoader.loadAds(AdRequest.Builder().build(), 1)
    }
}
```
```kt
class MainActivity : AppCompatActivity() {
    private lateinit var nativeEngine: NativeEngine

    override fun onCreate(savedInstanceState: Bundle?) {

        super.onCreate(savedInstanceState)
        val binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        nativeEngine = NativeEngine(this, binding.myTemplate)

        nativeEngine.load()

    }
}
```